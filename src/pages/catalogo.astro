---
import Layout from "../layouts/BaseLayout.astro";
import CatalogReactWrapper from "../components/cart/CatalogReactWrapper.jsx";
import { supabase } from "../lib/supabase.js";

console.log("üê±‚Äçüë§ URL:", import.meta.env.PUBLIC_SUPABASE_URL);
console.log("üê±‚Äçüë§ KEY existe:", import.meta.env.PUBLIC_SUPABASE_ANON_KEY ? "SI" : "NO");

const { data: products, error } = await supabase
  .from("productos")
  .select("*")
  .order("created_at", { ascending: false });

console.log("üì¶ Productos recibidos:", products);
console.log("‚ùå Error:", error);
---

<Layout title="Cat√°logo - Reposter√≠a D'Rossy">

  <!-- Header flotante -->
  <header
    class="fixed top-0 left-0 w-full z-50 backdrop-blur-xl bg-white/40 dark:bg-black/40 shadow-lg border-b border-white/50 dark:border-white/10"
  >
    <div
      class="max-w-6xl mx-auto flex justify-between items-center py-4 px-6 text-orange-700 font-bold"
    >
      <a href="/" class="text-3xl logo-glow">üéÇ D'Rossy</a>

      <nav class="hidden md:flex gap-6 font-semibold">
        <a href="/" class="hover:text-orange-500">Inicio</a>
        <a href="/catalogo" class="hover:text-orange-500">Cat√°logo</a>
        <a href="/nosotros" class="hover:text-orange-500">Nosotros</a>
        <a href="/login" class="hover:text-orange-500">Login</a>
        <a href="/carrito" class="hover:text-orange-500 text-2xl">üõí</a>
      </nav>

      <select
        id="modeSelect"
        class="bg-white/50 border px-2 py-1 rounded dark:bg-black/50"
        title="Cambiar tema"
      >
        <option value="normal">Normal</option>
        <option value="navidad">Navidad</option>
        <option value="valentin">San Valent√≠n</option>
        <option value="primavera">Primavera</option>
      </select>
    </div>
  </header>

  <!-- Contenido principal -->
  <div class="min-h-screen bg-gradient-to-b from-yellow-50 to-orange-50 p-6 pt-32">
    <h1 class="text-4xl font-bold mb-8 text-center text-orange-600 drop-shadow-lg">
      üåü Cat√°logo de Productos üåü
    </h1>

    <!-- üö´ SIN JSX / 100% ASTRO -->
    {error && <p class="text-red-500 text-center mb-4">Error cargando productos: {error.message}</p>}

    <CatalogReactWrapper products={products} client:load />
  </div>

  <style>
    .product-card {
      background: white;
      border-radius: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 1.5rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: fadeInUp 0.5s ease forwards;
    }

    .product-card:hover {
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 15px 35px rgba(0,0,0,0.18);
    }

    .product-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 1.5rem;
      margin-bottom: 1rem;
    }

    .product-card h3 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #c05621;
    }

    .product-card p {
      font-size: 1rem;
      color: #4a5568;
      margin-bottom: 1rem;
    }

    .add-to-cart-btn {
      background-color: #f97316;
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      font-weight: 600;
      text-align: center;
      transition: transform 0.2s ease, background-color 0.2s ease;
    }

    .add-to-cart-btn:hover {
      transform: scale(1.05);
      background-color: #ea580c;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .toast {
      animation: fadeInUp 0.4s ease forwards;
      z-index: 50;
    }

    @media (max-width: 768px) {
      .product-card img {
        height: 180px;
      }
    }
  </style>

</Layout>
